<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>手話通訳者の派遣申請</title>
        <link rel="stylesheet" href="./style.css">
    </head>
    <body>
        
        <p class="lead-form">手話通訳者の派遣申請</p>

        <form id="sign-interpreter-form">
        
            <div class="item">
                <label class="label">
                    名前（団体名）
                    <span class="required-mark">必須</span>
                </label>
                <input class="inputs" type="text" name="name" required>
            </div>

            <div class="item">
                <label class="label">担当者名</label>
                <input class="inputs" type="text" name="contact_person">
            </div>

            <div class="item">
                <label class="label">
                    住所
                    <span class="required-mark">必須</span>
                </label>
                <input class="inputs" type="text" name="address" required>
            </div>

            <div class="item">
                <label class="label">
                    電話番号
                    <span class="required-mark">必須</span>
                </label>
                <input class="inputs" type="text" name="phone" required>
            </div>

            <div class="item">
                <label class="label">FAX</label>
                <input class="inputs" type="text" name="fax">
            </div>

            <div class="item">
                <label class="label">
                    派遣日時
                    <span class="required-mark">必須</span>
                </label>
                <input class="inputs" type="datetime-local" name="dispatch_time" required>
            </div>

            <div class="item">
                <label class="label">
                    派遣先の住所
                    <span class="required-mark">必須</span>
                </label>
                <input class="inputs" type="text" name="dispatch_address" required>
            </div>

            <div class="item">
                <label class="label">
                    派遣先の会場名
                    <span class="required-mark">必須</span>
                </label>
                <input class="inputs" type="text" name="dispatch_venue" required>
            </div>

            <div class="item">
                <label class="label">
                    派遣先の電話番号
                    <span class="required-mark">必須</span>
                </label>
                <input class="inputs" type="text" name="dispatch_phone" required>
            </div>

            <div class="item">
                <label class="label">派遣先のFAX</label>
                <input class="inputs" type="text" name="dispatch_fax">
            </div>

            <div class="item">
                <label class="label">
                    申請事由
                    <span class="required-mark">必須</span>
                </label>
                <textarea class="inputs" name="reason" required></textarea>
            </div>

            <div class="btn-area">
                <button class="button" type="button" onclick="showCompletionAlert()">送信</button>
            </div>

        </form>

        <script>
            function showCompletionAlert() {
                const form = document.getElementById('sign-interpreter-form');
                
                // ブラウザ標準のバリデーションチェックを実行
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return; // 必須項目が未入力の場合は中断
                }
                
                // 1. フォームデータをFormDataオブジェクトで収集
                const formData = new FormData(form);
                const data = {};
                
                // 2. FormDataをシンプルなJavaScriptオブジェクトに変換
                formData.forEach((value, key) => {
                    data[key] = value;
                });

                // ★ 新しい項目 'new_field' の初期値を設定（Excelへの書き込みに合わせる）
                data['new_field'] = '処理中'; 

                console.log('送信データ:', data);
                
                // 3. fetch APIでデータをサーバーに非同期送信 (POST)
                fetch('http://192.168.0.125:8080/test-write-excel', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' // JSON形式で送信
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    // HTTPステータスコードを確認
                    if (!response.ok) {
                        throw new Error(`送信失敗: HTTP status ${response.status}`);
                    }
                    return response.json(); // サーバーからのJSON応答を解析
                })
                .then(responseData => {
                    // 成功時の処理
                    alert(`申請を送信しました。✅\nサーバー応答: ${responseData.message}`); 
                    form.reset(); // フォームをクリア
                })
                .catch(error => {
                    // エラー発生時の処理
                    console.error('送信エラー:', error);
                    alert('申請の送信中にエラーが発生しました。サーバーを確認してください。');
                });
            }
        </script>
    </body>
</html>